{% extends "base.html" %}
{% block content %}

<div class="game-container">

    <div class="game-card-display">

        <h2 class="menu-title">üÇ¥ Hearts 4 ‚Äì Moral Choice</h2>

        <p class="game-text">
            Read the dilemma carefully.<br>
            üëâ Choose with your <b>heart</b>.
        </p>

        <div class="emotion-hint">
            ‚ùå No ‚Äúwrong answer‚Äù, only feeling based<br>
            ‚ù§Ô∏è Emotional weight &gt; logic
        </div>
        

        <!-- START -->
        <button id="start-btn" class="btn red-btn">Start Choice</button>

        <!-- FEELING vs WEIGHT INFO (HIDDEN INITIALLY) -->
<div id="choice-info" class="choice-info">
    <div class="info-block feeling">
        ‚ù§Ô∏è <b>What is FEELING?</b><br>
        <span>‚ÄúThis hurts, but I care.‚Äù</span><br>
        <h4>>>> Choosing with empathy and attachment.</h4>
        <h5>>>> Feeling = choosing with emotion, empathy, attachment</h5>
    </div>


    <div class="info-block weight">
        ‚öñÔ∏è <b>What is WEIGHT?</b><br>
        <span>‚ÄúThis is heavy, but necessary.‚Äù</span><br>
        <h4>>>> Choosing with responsibility and consequence.</h4>
        <h5>>>> Weight = choosing with responsibility, consequence, realism</h5>
    </div>
</div>


        <!-- GAME AREA -->
        <div id="game-area" style="display:none;">

            <p id="timer" class="timer-text">Time Left: 9s</p>

            <p id="progress" class="progress-text">Choice 1 of 3</p>

            <!-- DILEMMA -->
            <div id="dilemma" class="dilemma-box"></div>

            <!-- OPTIONS -->
            <div id="choices" class="choice-box"></div>

            <p id="result" class="result-text"></p>

            <!-- NAV -->
            <div class="button-row">
                <a id="next-btn"
                   href="{{ url_for('main.suit_cards', suit='hearts') }}"
                   class="btn card-btn"
                   style="display:none;">
                   Next Card ‚Üí
                </a>

                <a href="{{ url_for('main.suit_cards', suit='hearts') }}"
                   class="btn card-btn">
                   Back
                </a>
            </div>

        </div>
        __________________________________
        <div class="info-block feeling">
            ‚ù§Ô∏è <b>What is FEELING?</b><br />
            <span>‚ÄúThis hurts, but I care.‚Äù</span><br />
            <h4>>>> Choosing with empathy and attachment.</h4>
            <h5>>>> Feeling = choosing with emotion, empathy, attachment</h5>
          </div>
    __________________________________
          <div class="info-block weight">
            ‚öñÔ∏è <b>What is WEIGHT?</b><br />
            <span>‚ÄúThis is heavy, but necessary.‚Äù</span><br />
            <h4>>>> Choosing with responsibility and consequence.</h4>
            <h5>>>> Weight = choosing with responsibility, consequence, realism</h5>
          </div>

    </div>

    <!-- FLOATING HEARTS 4 CARD -->
    <div class="floating-card">
        <img src="https://deckofcardsapi.com/static/img/4H.png"
             class="card-image glow-float"
             alt="Hearts 4">
    </div>

</div>

<script>
    /* ===========================
       DILEMMAS POOL
    =========================== */
    const dilemmas = [
        {
            text: "Someone you love made a terrible mistake.",
            choices: [
                { text: "Stand by them", type: "FEELING" },
                { text: "Walk away", type: "WEIGHT" }
            ]
        },
        {
            text: "Telling the truth will hurt deeply.",
            choices: [
                { text: "Protect their feelings", type: "FEELING" },
                { text: "Tell the truth", type: "WEIGHT" }
            ]
        },
        {
            text: "You can save only one person.",
            choices: [
                { text: "Your friend", type: "FEELING" },
                { text: "A stranger", type: "WEIGHT" }
            ]
        },
        {
            text: "Forgiving may hurt you again.",
            choices: [
                { text: "Forgive anyway", type: "FEELING" },
                { text: "Protect yourself", type: "WEIGHT" }
            ]
        },
        {
            text: "Helping them will cost you your future.",
            choices: [
                { text: "Help them anyway", type: "FEELING" },
                { text: "Protect your future", type: "WEIGHT" }
            ]
        },
        {
            text: "You promised to stay, but staying will hurt you.",
            choices: [
                { text: "Keep the promise", type: "FEELING" },
                { text: "Leave to heal", type: "WEIGHT" }
            ]
        },
        {
            text: "Someone asks for forgiveness too late.",
            choices: [
                { text: "Forgive them", type: "FEELING" },
                { text: "Move on without them", type: "WEIGHT" }
            ]
        },
        {
            text: "Speaking up could protect others, but cost you everything.",
            choices: [
                { text: "Speak up", type: "WEIGHT" },
                { text: "Stay silent", type: "FEELING" }
            ]
        },
        {
            text: "You know the truth, but revealing it will destroy a family.",
            choices: [
                { text: "Keep the secret", type: "FEELING" },
                { text: "Reveal the truth", type: "WEIGHT" }
            ]
        },
        {
            text: "Someone depends on you, but you are exhausted.",
            choices: [
                { text: "Be there for them", type: "FEELING" },
                { text: "Take care of yourself", type: "WEIGHT" }
            ]
        },
        {
            text: "Staying loyal means staying in pain.",
            choices: [
                { text: "Stay loyal", type: "FEELING" },
                { text: "Choose peace", type: "WEIGHT" }
            ]
        },
        {
            text: "You can fix the problem, but no one will thank you.",
            choices: [
                { text: "Fix it anyway", type: "WEIGHT" },
                { text: "Walk away", type: "FEELING" }
            ]
        },
        {
            text: "They hurt you, but they are the only one who understands you.",
            choices: [
                { text: "Give them another chance", type: "FEELING" },
                { text: "Protect yourself", type: "WEIGHT" }
            ]
        },
        {
            text: "Letting go will hurt now, staying will hurt forever.",
            choices: [
                { text: "Let go", type: "WEIGHT" },
                { text: "Hold on", type: "FEELING" }
            ]
        },        
        {
            text: "Leaving keeps you safe, staying keeps a promise.",
            choices: [
                { text: "Stay", type: "FEELING" },
                { text: "Leave", type: "WEIGHT" }
            ]
        }
    ];
    
    /* ===========================
       FINAL THOUGHTS
    =========================== */
    const feelingThoughts = [
        "‚ù§Ô∏è You chose with empathy. Even when it hurts, your heart speaks louder.",
        "‚ù§Ô∏è You chose connection over distance.",
        "‚ù§Ô∏è You listened to feelings instead of fear.",
        "‚ù§Ô∏è Your compassion guided your decisions.",
        "‚ù§Ô∏è You stayed human in a difficult moment."
    ];
    
    const weightThoughts = [
        "‚öñÔ∏è You chose responsibility over comfort.",
        "‚öñÔ∏è You accepted the weight of consequence.",
        "‚öñÔ∏è You stood firm when emotions pulled you away.",
        "‚öñÔ∏è You carried the burden with strength.",
        "‚öñÔ∏è Sometimes strength means choosing the hard path."
    ];
    
    /* ===========================
       ELEMENTS
    =========================== */
    const startBtn = document.getElementById("start-btn");
    const gameArea = document.getElementById("game-area");
    const dilemmaEl = document.getElementById("dilemma");
    const choicesEl = document.getElementById("choices");
    const resultEl = document.getElementById("result");
    const timerEl = document.getElementById("timer");
    const nextBtn = document.getElementById("next-btn");
    const progressEl = document.getElementById("progress");
    const infoPanel = document.getElementById("choice-info");
    
    /* ===========================
       STATE
    =========================== */
    let selectedDilemmas = [];
    let currentIndex = 0;
    let feelingCount = 0;
    let weightCount = 0;
    let timer = 9;
    let interval = null;
    
    /* ===========================
       START GAME
    =========================== */
    startBtn.onclick = () => {
        startBtn.style.display = "none";
        gameArea.style.display = "block";
        infoPanel.style.display = "flex";
    
        // üî• PICK 3 RANDOM DILEMMAS
        selectedDilemmas = [...dilemmas]
            .sort(() => 0.5 - Math.random())
            .slice(0, 3);
    
        currentIndex = 0;
        feelingCount = 0;
        weightCount = 0;
    
        loadQuestion();
    };
    
    /* ===========================
       LOAD QUESTION
    =========================== */
    function loadQuestion() {
        clearInterval(interval);
        resultEl.textContent = "";
        choicesEl.innerHTML = "";
    
        timer = 9;
        timerEl.textContent = `Time Left: ${timer}s`;
        progressEl.textContent = `Choice ${currentIndex + 1} of 3`;
    
        const q = selectedDilemmas[currentIndex];
        dilemmaEl.textContent = q.text;
    
        q.choices.forEach(choice => {
            const btn = document.createElement("button");
            btn.className = "choice-btn";
            btn.textContent = choice.text;
            btn.onclick = () => selectChoice(choice.type);
            choicesEl.appendChild(btn);
        });
    
        startTimer();
    }
    
    /* ===========================
       TIMER
    =========================== */
    function startTimer() {
        interval = setInterval(() => {
            timer--;
            timerEl.textContent = `Time Left: ${timer}s`;
    
            if (timer <= 0) {
                clearInterval(interval);
                selectChoice("WEIGHT");
            }
        }, 1000);
    }
    
    /* ===========================
       CHOICE HANDLER
    =========================== */
    function selectChoice(type) {
        clearInterval(interval);
    
        if (type === "FEELING") feelingCount++;
        else weightCount++;
    
        currentIndex++;
    
        if (currentIndex < 3) {
            loadQuestion();
        } else {
            showFinalResult();
        }
    }
    
    /* ===========================
       FINAL RESULT
    =========================== */
    function showFinalResult() {
        clearInterval(interval);
    
        // üî• REMOVE QUESTION UI COMPLETELY
        dilemmaEl.remove();
        choicesEl.remove();
        progressEl.remove();
        timerEl.remove();
    
        let majorityText = "";
        let finalMessage = "";
    
        if (feelingCount >= 2) {
            majorityText = "üíó You won by majority of FEELING choices.";
            finalMessage =
                feelingThoughts[Math.floor(Math.random() * feelingThoughts.length)];
        } else {
            majorityText = "‚öñÔ∏è You won by majority of WEIGHTED choices.";
            finalMessage =
                weightThoughts[Math.floor(Math.random() * weightThoughts.length)];
        }
    
        resultEl.innerHTML = `
            <div class="majority-text">${majorityText}</div>
            <div class="final-thought">${finalMessage}</div>
        `;
    
        nextBtn.style.display = "inline-block";
        fetch("/complete/hearts/4", { method: "POST" });
    }
    </script>
    

<style>
.emotion-hint {
    margin-top: 10px;
    font-size: 16px;
    color: #ffcccc;
    opacity: 0.85;
}

.progress-text {
    margin-top: 10px;
    font-size: 18px;
    color: #ffdddd;
}

.dilemma-box {
    font-size: 24px;
    font-weight: bold;
    margin: 22px 0;
    padding: 18px;
    background: rgba(0,0,0,0.55);
    border-left: 4px solid pink;
    color: #ffecec;
}

.choice-box {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.choice-btn {
    padding: 16px;
    font-size: 18px;
    font-weight: bold;
    background: rgba(0,0,0,0.6);
    color: #ffecec;
    border: 2px solid pink;
    border-radius: 14px;
    cursor: pointer;
    transition: 0.2s ease;
}

.choice-btn:hover {
    background: pink;
    color: black;
    transform: scale(1.03);
}

.timer-text {
    font-size: 22px;
    color: #ffcccc;
}

.button-row {
    margin-top: 30px;
    display: flex;
    justify-content: center;
    gap: 25px;
}
.majority-text {
    margin-top: 10px;
    font-size: 18px;
    color:rgb(94, 255, 0);
    opacity: 0.9;
}

.final-thought {
    margin-top: 14px;
    font-size: 22px;
    color: #ffcccc;
    font-weight: bold;
}
/* FEELING vs WEIGHT PANEL */
.choice-info {
    position: absolute;
    left: -300px;
    top: 5px;
    width: 260px;
    display: none;
    flex-direction: column;
    gap: 16px;
    z-index: 6;
}

.info-block {
    background: rgba(0, 0, 0, 0.65);
    border-left: 4px solid;
    padding: 14px;
    border-radius: 8px;
    font-size: 15px;
    line-height: 1.4;
    color: #ffecec;
}

.info-block span {
    display: block;
    font-style: italic;
    color: #ffcccc;
    margin: 6px 0;
}

/* Feeling style */
.info-block.feeling {
    border-color: #ff4d6d;
}

/* Weight style */
.info-block.weight {
    border-color: #ffd166;
}

</style>

{% endblock %}
