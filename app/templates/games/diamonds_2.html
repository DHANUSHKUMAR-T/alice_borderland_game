{% extends "base.html" %}
{% block content %}

<div class="game-container">

    <div class="game-card-display">

        <h2 class="menu-title">üÇ¢ Diamonds 2 ‚Äì Logic Lock</h2>

        <p class="game-text">
            One option is <b>logically correct</b>.<br>
            Others sound right ‚Äî but are false friends.
        </p>

        <div class="emotion-hint">
            üß† Think clearly, not emotionally<br>
            üíé Logic &gt; assumptions
        </div>

        <!-- START -->
        <button id="start-btn" class="btn red-btn">Unlock Logic</button>

        <!-- GAME AREA -->
        <div id="game-area" style="display:none;">

            <p id="timer" class="timer-text">Time Left: 30s</p>
            <p id="round-info" class="round-text">Round 1 / 3</p>

            <!-- CAUSE -->
            <div id="cause" class="cause-box"></div>

            <!-- OPTIONS -->
            <div id="options" class="option-box"></div>

            <p id="result" class="result-text"></p>

            <!-- NAV -->
            <div class="button-row">
                <a id="next-btn"
                   href="{{ url_for('main.suit_cards', suit='diamonds') }}"
                   class="btn card-btn"
                   style="display:none;">
                   Next Card ‚Üí
                </a>

                <a href="{{ url_for('main.suit_cards', suit='diamonds') }}"
                   class="btn card-btn">
                   Back
                </a>
            </div>

        </div>

    </div>

    <!-- FLOATING DIAMONDS 2 CARD -->
    <div class="floating-card">
        <img src="https://deckofcardsapi.com/static/img/2D.png"
             class="card-image glow-float"
             alt="Diamonds 2">
    </div>

</div>

<script>
/* ===========================
   SCENARIOS
=========================== */
const scenarios = [
    {
        cause: "You don‚Äôt sleep for 24 hours.",
        options: [
            "You instantly fall asleep anywhere",
            "Your brain shuts down",
            "You lose all memory",
            "You feel tired and unfocused"
        ],
        correct: 3
    },
    {
        cause: "You delete an app from your phone.",
        options: [
            "The app still runs in background",
            "The app updates itself",
            "The app is removed from storage",
            "The app sends notifications"
        ],
        correct: 2
    },
    {
        cause: "You forgot your phone at home.",
        options: [
            "Your phone stops receiving calls",
            "Your phone battery drains faster",
            "You cannot answer calls",
            "Your phone switches off"
        ],
        correct: 2
    },{
        cause: "You turn your phone to airplane mode.",
        options: [
            "Your phone battery drains faster",
            "You receive calls silently",
            "Wireless connections are disabled",
            "Your phone switches off"
        ],
        correct: 2
    },
    {
        cause: "You stop drinking water for a whole day.",
        options: [
            "You instantly faint",
            "You feel thirsty and tired",
            "Your organs shut down",
            "You lose consciousness immediately"
        ],
        correct: 1
    },
    {
        cause: "You log out of your email account.",
        options: [
            "Your emails are deleted",
            "You stop receiving new emails",
            "Your email address is disabled",
            "Your phone restarts"
        ],
        correct: 1
    },
    {
        cause: "You mute a group chat.",
        options: [
            "Messages are deleted",
            "People cannot message you",
            "Notifications stop appearing",
            "The group is removed"
        ],
        correct: 2
    },
    {
        cause: "You forget to charge your phone overnight.",
        options: [
            "Your phone battery increases slowly",
            "Your phone overheats",
            "Your phone has low battery in the morning",
            "Your phone resets itself"
        ],
        correct: 2
    },
    {
        cause: "You close all apps running in background.",
        options: [
            "Your phone loses internet acces by closed apps",
            "Apps stop consuming background resources",
            "Your phone shuts down",
            "Your storage becomes empty"
        ],
        correct: 1
    },
    {
        cause: "You turn off location services.",
        options: [
            "Navigation systems are not works",
            "Apps cannot access your location",
            "Your phone cannot connect to Wi-Fi",
            "Your GPS hardware breaks"
        ],
        correct: 1
    },
    {
        cause: "You set an alarm but keep the phone switched on silent.",
        options: [
            "The alarm will not ring",
            "The alarm vibrates or rings anyway",
            "The phone switches off",
            "The alarm deletes itself"
        ],
        correct: 1
    },
    {
        cause: "Your internet is turned off.",
        options: [
            "Websites load slower",
            "Apps update automatically",
            "Messages arrive late",
            "Online services stop working"
        ],
        correct: 3
    }
];

/* ===========================
   ELEMENTS
=========================== */
const startBtn = document.getElementById("start-btn");
const gameArea = document.getElementById("game-area");
const causeEl = document.getElementById("cause");
const optionsEl = document.getElementById("options");
const resultEl = document.getElementById("result");
const timerEl = document.getElementById("timer");
const nextBtn = document.getElementById("next-btn");
const roundInfo = document.getElementById("round-info");

/* ===========================
   STATE
=========================== */
let timer = 30;
let interval = null;
let round = 1;
const TOTAL_ROUNDS = 3;
let currentScenario = null;

/* ===========================
   START GAME
=========================== */
startBtn.onclick = () => {
    startBtn.style.display = "none";
    gameArea.style.display = "block";
    round = 1;
    loadScenario();
};

/* ===========================
   LOAD SCENARIO
=========================== */
function loadScenario() {
    clearInterval(interval);
    resultEl.textContent = "";
    optionsEl.innerHTML = "";
    nextBtn.style.display = "none";

    timer = 30;
    timerEl.textContent = `Time Left: ${timer}s`;
    roundInfo.textContent = `Round ${round} / ${TOTAL_ROUNDS}`;

    currentScenario =
        scenarios[Math.floor(Math.random() * scenarios.length)];

    causeEl.textContent = currentScenario.cause;

    currentScenario.options.forEach((text, index) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = text;
        btn.onclick = () => choose(index);
        optionsEl.appendChild(btn);
    });

    startTimer();
}

/* ===========================
   TIMER
=========================== */
function startTimer() {
    interval = setInterval(() => {
        timer--;
        timerEl.textContent = `Time Left: ${timer}s`;

        if (timer <= 0) {
            clearInterval(interval);
            fail("‚è≥ Time ran out. Think again.");
        }
    }, 1000);
}

/* ===========================
   CHOICE HANDLER
=========================== */
function choose(index) {
    clearInterval(interval);

    if (index === currentScenario.correct) {
        resultEl.textContent = "üíé Correct. Logic unlocked.";
        resultEl.style.color = "#00ff66";

        if (round < TOTAL_ROUNDS) {
            setTimeout(() => {
                round++;
                loadScenario();
            }, 1200);
        } else {
            finishGame();
        }
    } else {
        fail("‚ùå Sounds right, but logically wrong.");
    }
}

/* ===========================
   FAIL
=========================== */
function fail(msg) {
    resultEl.textContent = msg;
    resultEl.style.color = "#ffcccc";

    setTimeout(loadScenario, 1400);
}

/* ===========================
   FINAL SUCCESS
=========================== */
function finishGame() {
    resultEl.textContent =
        "üíé You cleared all logic locks. Precision beats assumption.";
    resultEl.style.color = "#00ff66";

    nextBtn.style.display = "inline-block";
    fetch("/complete/diamonds/2", { method: "POST" });
}
</script>

<style>
.cause-box {
    font-size: 24px;
    font-weight: bold;
    margin: 22px 0;
    padding: 18px;
    background: rgba(0,0,0,0.55);
    border-left: 4px solid #66ccff;
    color: #e6f6ff;
}

.option-box {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.option-btn {
    padding: 15px;
    font-size: 17px;
    font-weight: bold;
    background: rgba(0,0,0,0.6);
    color: #e6f6ff;
    border: 2px solid #66ccff;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s ease;
}

.option-btn:hover {
    background: #66ccff;
    color: black;
    transform: scale(1.03);
}

.timer-text, .round-text {
    font-size: 22px;
    color: #99ddff;
}

.emotion-hint {
    font-size: 16px;
    color: #bfe9ff;
    margin-bottom: 10px;
    opacity: 0.85;
}

.button-row {
    margin-top: 30px;
    display: flex;
    justify-content: center;
    gap: 25px;
}
</style>

{% endblock %}
