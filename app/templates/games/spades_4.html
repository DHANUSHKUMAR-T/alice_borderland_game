{% extends "base.html" %}
{% block content %}

<div class="game-container">

    <div class="game-card-display">

        <h2 class="menu-title">ðŸ‚¤ Spades 4 â€“ Big Even / Odd Finder</h2>

        <p class="game-text">
            Choose the correct number based on the instruction!
        </p>

        <div id="instruction" class="instruction-text"></div>
        <p id="timer" class="timer-text">Time Left: 6s</p>

        <div id="numbers" class="numbers-box"></div>

        <p id="result" class="result-text"></p>

        <!-- BUTTON ROW (A / 2 / 3 STYLE) -->
        <div class="button-row">
            <button id="start-btn" class="btn red-btn">Start Game</button>

            <a id="next-btn"
            href="{{ url_for('main.suit_cards', suit='spades') }}"
               class="btn card-btn"
               style="display:none;">
               Next Card â†’
            </a>

            <a href="{{ url_for('main.suit_cards', suit='spades') }}"
               class="btn card-btn">
               Back
            </a>
        </div>

    </div>

    <!-- FLOATING GLOWING SPADE 4 CARD -->
    <div class="floating-card">
        <img src="https://deckofcardsapi.com/static/img/4S.png"
             class="card-image glow-float"
             alt="Spades 4">
    </div>

</div>

<script>
const instructionEl = document.getElementById("instruction");
const numbersEl = document.getElementById("numbers");
const resultEl = document.getElementById("result");
const startBtn = document.getElementById("start-btn");
const nextBtn = document.getElementById("next-btn");
const timerEl = document.getElementById("timer");

let numbers = [];
let mode = "";
let timer = 6;
let timerInterval = null;
let gameCompleted = false;

/* ---------------- START GAME ---------------- */
function startGame() {
    if (gameCompleted) return;

    clearInterval(timerInterval);
    resultEl.textContent = "";
    startBtn.style.display = "none";
    nextBtn.style.display = "none";

    timer = 6;
    timerEl.textContent = `Time Left: ${timer}s`;

    mode = Math.random() < 0.5 ? "EVEN" : "ODD";

    instructionEl.textContent =
        mode === "EVEN"
        ? "ðŸ‘‰ Find the BIGGEST EVEN number!"
        : "ðŸ‘‰ Find the BIGGEST ODD number!";

    numbers = Array.from({ length: 4 }, () =>
        Math.floor(Math.random() * 90) + 10
    );

    numbersEl.innerHTML = "";
    numbers.forEach(num => {
        const btn = document.createElement("button");
        btn.className = "num-btn";
        btn.textContent = num;
        btn.onclick = () => checkAnswer(num);
        numbersEl.appendChild(btn);
    });

    startTimer();
}

/* ---------------- TIMER ---------------- */
function startTimer() {
    timerInterval = setInterval(() => {
        timer--;
        timerEl.textContent = `Time Left: ${timer}s`;

        if (timer <= 0) {
            clearInterval(timerInterval);
            failGame("â³ Timeâ€™s up!");
        }
    }, 1000);
}

/* ---------------- CHECK ANSWER ---------------- */
function checkAnswer(selected) {
    if (gameCompleted) return;

    clearInterval(timerInterval);

    const valid = numbers.filter(n =>
        mode === "EVEN" ? n % 2 === 0 : n % 2 === 1
    );

    if (valid.length === 0) {
        failGame("âš  No valid numbers!");
        return;
    }

    const correct = Math.max(...valid);

    if (selected === correct) {
        winGame();
    } else {
        failGame(`âŒ Wrong! Correct was ${correct}`);
    }
}

/* ---------------- WIN ---------------- */
function winGame() {
    gameCompleted = true;

    resultEl.textContent = "ðŸŽ‰ Correct! Well done!";
    resultEl.style.color = "#00ff66";

    nextBtn.style.display = "inline-block";

    fetch("/complete/spades/4", { method: "POST" });
}

/* ---------------- FAIL ---------------- */
function failGame(msg) {
    resultEl.textContent = msg;
    resultEl.style.color = "#ff3333";

    setTimeout(() => {
        resultEl.textContent = "";
        startBtn.style.display = "inline-block";
        numbersEl.innerHTML = "";
    }, 1600);
}

startBtn.addEventListener("click", startGame);
</script>

<style>
.instruction-text {
    font-size: 22px;
    font-weight: bold;
    margin-top: 12px;
    color: #ff5555;
    text-shadow: 0 0 6px black;
}

.timer-text {
    font-size: 22px;
    margin-top: 10px;
    color: #ffff66;
    text-shadow: 0 0 6px black;
}

.numbers-box {
    margin-top: 25px;
    display: flex;
    justify-content: center;
    gap: 18px;
}

.num-btn {
    padding: 15px 26px;
    font-size: 26px;
    font-weight: bold;
    background: #111;
    color: white;
    border: 2px solid red;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.2s ease;
}

.num-btn:hover {
    background: red;
    transform: scale(1.12);
}

.button-row {
    margin-top: 30px;
    display: flex;
    justify-content: center;
    gap: 25px;
}

.result-text {
    margin-top: 20px;
    font-size: 22px;
    font-weight: bold;
}
</style>

{% endblock %}
